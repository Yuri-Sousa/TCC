function WWP_Suggest_UC(n){this.show=function(){};this.Attach=function(t,i){this.SelectedItemsJson="";var r=this;n("#"+i).data("wwpUC",this).suggest(t,{data:function(t,i){t!=null&&t!=""?(r.ajaxCall!=null&&r.ajaxCall.abort(),r.ajaxCall=n.ajax({"async":!0,type:"POST",url:WWP_getAjaxCallRestURL(r.DataListProc),headers:{Authorization:r.GAMOAuthToken},contentType:"application/json",data:'{"SearchTxt": "'+t+'"}',success:function(n){i(JSON.parse(n.OptionsJson))},error:function(n,t,i){console.log("jqXHR statusCode"+n.statusCode());console.log("textStatus "+t);console.log("errorThrown "+i);n!=null&&n.status==401&&window.location.reload()}})):i([])},map:function(n){var f={value:WWP_replaceAll(n.dn.trim()," ","_"),id:n.Id},i=document.createElement("span"),u=r.ItemHtmlTemplate,t;if(u!=""){for(t=Math.max(n.t.length,10);t>0;t--)i.innerText=n.t.length>=t?n.t[t-1]:"",u=WWP_replaceAll(u,"%"+t,WWP_replaceAll(i.innerHTML,"%","[%]"));f.text=WWP_replaceAll(u,"[%]","%")}else i.innerText=n.t.length>0?n.t[0]:"",f.text=i.innerHTML;return f},dropdownClass:r.Cls})}}(function(n){"use strict";var t=function(t,i,r){var u=this;this.$element=n(t);this.$items=undefined;this.options=n.extend(!0,{},n.fn.suggest.defaults,r,this.$element.data(),this.$element.data("options"));this.key=i;this.isShown=!1;this.query="";this._queryPos=[];this._keyPos=-1;this.$dropdown=n("<div />",{"class":"dropdown suggest "+this.options.dropdownClass,html:n("<div />",{"class":"dropdown-menu",role:"menu"}),"data-key":this.key});this.selectedIds=[];this.selectedDNs=[];this.load()},i;t.prototype={__setListener:function(){this.$element.on("suggest.show",n.proxy(this.options.onshow,this)).on("suggest.select",n.proxy(this.options.onselect,this)).on("suggest.lookup",n.proxy(this.options.onlookup,this)).on("keyup",n.proxy(this.__keyup,this));return this},__getCaretPos:function(t){var i=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"],r=!(window.mozInnerScreenX==null),u=function(t,u){var e=document.createElement("div"),f,o,s,h;return e.id="input-textarea-caret-position-mirror-div",document.body.appendChild(e),f=e.style,o=window.getComputedStyle?getComputedStyle(t):t.currentStyle,f.whiteSpace="pre-wrap",t.nodeName!=="INPUT"&&(f.wordWrap="break-word"),f.position="absolute",f.visibility="hidden",n.each(i,function(n,t){f[t]=o[t]}),r?(f.width=parseInt(o.width)-2+"px",t.scrollHeight>parseInt(o.height)&&(f.overflowY="scroll")):f.overflow="hidden",e.textContent=t.value.substring(0,u),t.nodeName==="INPUT"&&(e.textContent=e.textContent.replace(/\s/g,"Â ")),s=document.createElement("span"),s.textContent=t.value.substring(u)||".",e.appendChild(s),h={top:s.offsetTop+parseInt(o.borderTopWidth),left:s.offsetLeft+parseInt(o.borderLeftWidth)},document.body.removeChild(e),h};return u(this.$element.get(0),t)},__keyup:function(t){var e,i,f,s;this.__CleanSelectedItems();e=[38,40,37,39,17,18,9,16,20,91,93,36,35,45,33,34,144,112,113,114,115,116,117,118,119,120,121,122,123,145,19];switch(t.keyCode){case 27:this.hide();return;case 13:return!0}if(n.inArray(t.keyCode,e)===-1){var o=this.$element,r=o.val(),u=this.__getSelection(o.get(0)).start;for(i=u;i>=0;i--){if(f=n.trim(r.substring(i-1,i)),!f&&this.options.respectWhitespace){this.hide();break}if(s=n.trim(r.substring(i-2,i-1))=="",f===this.key&&(s||!this.options.respectWhitespace)){this.query=r.substring(i,u);this._queryPos=[i,u];this._keyPos=i;this.lookup(this.query);break}}}},__getVisibleItems:function(){return this.$items?this.$items.not(".d-none"):n()},__build:function(){var r=this.$dropdown,t=this,i=function(){t.hide()};r.on("click","a.dropdown-item",function(i){i.preventDefault();i.stopPropagation();t.__select(n(this).index());t.$element.focus();t.$element[0].selectionStart=t.$element[0].value.length}).on("mouseover","a.dropdown-item",function(){t.$element.off("blur",i)}).on("mouseout","a.dropdown-item",function(){t.$element.on("blur",i)});this.$element.before(r).on("blur",i).on("keydown",function(i){var r;if(t.$element.data("suggestEnterCaptured",null),t.isShown)switch(i.keyCode){case 13:t.$element.data("suggestEnterCaptured",!0);case 9:return r=t.__getVisibleItems(),r.each(function(){n(this).is(".active")&&t.__select(n(this).index())}),t.$element.focus(),!1;case 40:return(r=t.__getVisibleItems(),r.last().is(".active"))?!1:(r.each(function(t){var i=n(this),u=r.eq(t+1);if(i.is(".active"))return u.is(".d-none")||(i.removeClass("active"),u.addClass("active")),!1}),!1);case 38:return(r=t.__getVisibleItems(),r.first().is(".active"))?!1:(r.each(function(t){var i=n(this),u=r.eq(t-1);if(i.is(".active"))return u.is(".d-none")||(i.removeClass("active"),u.addClass("active")),!1}),!1)}})},__mapItem:function(t){var r=this,i={text:"",value:"","class":""};return this.options.map&&(t=this.options.map(t),!t)?!1:(t instanceof Object?(i.text=t.text||"",i.value=t.value||"",i.id=t.id||"",i.class=t.class||""):(i.text=t,i.value=t,i.id=t),n("<a />",{"class":"dropdown-item "+i.class,"data-value":i.value,"data-id":i.id,href:"#",html:i.text}))},__select:function(t){var s=this.options.endKey||"",i=this.$element,u=i.get(0),o=i.val(),r=this.get(t),e=this._keyPos+r.value.length+1,f;i.val(o.slice(0,this._keyPos)+r.value+s+" "+o.slice(this.__getSelection(u).start));i.blur();this.selectedIds.indexOf(r.id)==-1&&(this.selectedIds.push(r.id),this.selectedDNs.push(r.value),i.data("wwpUC").SelectedItemsJson=JSON.stringify(this.selectedIds,null,2));u.setSelectionRange?u.setSelectionRange(e,e):u.createTextRange&&(f=u.createTextRange(),f.collapse(!0),f.moveEnd("character",e),f.moveStart("character",e),f.select());i.trigger(n.extend({type:"suggest.select"},this),r);this.hide()},__CleanSelectedItems:function(){for(var t=this.$element.val(),n=0;n<this.selectedDNs.length;n++)t.indexOf(this.key+this.selectedDNs[n]+" ")==-1&&(this.selectedIds.splice(n,1),this.selectedDNs.splice(n,1));this.$element.data("wwpUC").SelectedItemsJson=JSON.stringify(this.selectedIds,null,2)},__getSelection:function(n){return n.focus(),{start:n.selectionStart,end:n.selectionEnd}},__buildItems:function(n){var i=this.$dropdown.find(".dropdown-menu"),t,r;if(i.empty(),n&&n instanceof Array)for(t=0;t<n.length;t++)r=this.__mapItem(n[t]),r&&i.append(r);return i.find("a.dropdown-item")},__lookup:function(t,i){var r=i.eq(0).addClass("active");this.$element.trigger(n.extend({type:"suggest.lookup"},this),[t,i]);i&&i.length?this.show():this.hide()},__filterData:function(t){var i=this.options;return this.$items.addClass("d-none"),this.$items.filter(function(r){if(t==="")return r<i.filter.limit;var u=n(this).text(),f=n(this).data().value;return i.filter.casesensitive||(u=u.toLowerCase(),t=t.toLowerCase(),f=f.toLowerCase()),u.indexOf(t)!=-1||f.indexOf(t)!=-1}).slice(0,i.filter.limit).removeClass("d-none active"),this.__getVisibleItems()},get:function(n){if(this.$items){var t=this.$items.eq(n);return{text:t.text(),value:t.attr("data-value"),id:t.attr("data-id"),index:n,$element:t}}},lookup:function(n){var u=this.options,i=this,t,r=function(t){i._keyPos!==-1&&(i.$items||(i.$items=i.__buildItems(t)),i.__lookup(n,i.__filterData(n,t)))};typeof this.options.data=="function"?(this.$items=undefined,t=this.options.data(n,r)):t=this.options.data;t&&typeof t.promise=="function"?t.done(r):t&&r.call(this,t)},load:function(){this.__setListener();this.__build()},hide:function(){this.$dropdown.find(".dropdown-menu").removeClass("show");this.isShown=!1;this.$items&&this.$items.removeClass("active");this._keyPos=-1;for(var n=this.$element.parent();n[0]!=document&&n.length==1&&n.css("overflow")!="hidden"&&n.css("overflow-y")!="auto";)n=n.parent();n[0]!=document&&n.length==1&&n.css("overflow")=="hidden"&&n.data("orig-padding-bottom")!=null&&n.css("padding-bottom",n.data("orig-padding-bottom"))},show:function(){var e=this.$element,r=this.$dropdown.find(".dropdown-menu"),s=e.get(0),u=this.options,o,i={top:"auto",bottom:"auto",left:"auto",right:"auto"},t,f,h,c,l;if(!this.isShown){if(r.addClass("show"),u.position!==!1){if(o=this.__getCaretPos(this._keyPos),typeof u.position=="string")switch(u.position){case"bottom":i.top=e.outerHeight()-parseFloat(r.css("margin-top"));i.left=0;i.right=0;break;case"top":i.top=-(r.outerHeight(!0)+parseFloat(r.css("margin-top")));i.left=0;i.right=0;break;case"caret":i.top=o.top-s.scrollTop;i.left=o.left-s.scrollLeft}else i=n.extend(i,typeof u.position=="function"?u.position(s,o):u.position);r.css(i)}this.isShown=!0;e.trigger(n.extend({type:"suggest.show"},this))}for(t=e.parent();t[0]!=document&&t.length==1&&t.css("overflow")!="hidden"&&t.css("overflow-y")!="auto";)t=t.parent();t.length==1&&t.css("overflow")=="hidden"&&(f=0,t.data("orig-padding-bottom")!=null&&(f=parseInt(t.css("padding-bottom"))-t.data("orig-padding-bottom")),h=r.offset().top+r.outerHeight()+5,c=t.offset().top+t.outerHeight(),h>c-f?(l=parseInt(t.css("padding-bottom")),t.css("padding-bottom",h-c+l),f==0&&t.data("orig-padding-bottom",l)):f>0&&t.css("padding-bottom",t.data("orig-padding-bottom")))}};i=n.fn.suggest;n.fn.suggest=function(i){var r=arguments[1],f=arguments[2],u=function(i,r){var u={};return n.each(r,function(n,r){var f=n.toString().charAt(0);u[f]=new t(i,f,typeof r=="object"&&r)}),u};return this.each(function(){var s=this,o=n(this),t=o.data("suggest"),e={};if(typeof i=="string")if(i.length==1){if(r)if(typeof r=="string"){if(i in t&&typeof t[i][r]!="undefined")return t[i][r].call(t[i],f);console.error(i+" is not a suggest")}else e[i]=n.isArray(r)||typeof r=="function"?{data:r}:r,t&&i in t?t[i].options=n.extend({},t[i].options,e[i]):t=n.extend(t,u(this,e)),o.data("suggest",t)}else console.error("you're not initializing suggest properly. arg1 should have length == 1");else t?t&&(n.each(i,function(i,r){i in t==!1?e[i]=r:t[i].options=n.extend({},t[i].options,r)}),o.data("suggest",n.extend(t,u(s,e)))):o.data("suggest",u(this,i))})};n.fn.suggest.defaults={data:[],map:undefined,filter:{casesensitive:!1,limit:100},dropdownClass:"",position:"caret",endKey:"",respectWhitespace:!0,onshow:function(){},onselect:function(){},onlookup:function(){}};n.fn.suggest.Constructor=t;n.fn.suggest.noConflict=function(){return n.fn.suggest=i,this}})(jQuery)